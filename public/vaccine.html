<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>백신 관련 정보</title>
    <link rel="stylesheet" type="text/css" href="./style.css">

    <!-- Semantic -->
    <link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">
    <!--배경 색을 지정함-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="semantic/semantic.min.js"></script>

    <!-- DataTables -->
    <link rel="stylesheet" type="text/css" href="DataTables/datatables.min.css" />
    <script type="text/javascript" src="DataTables/datatables.min.js"></script>

</head>
<body style="background-color: #FAFAFA;">
<!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>

    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-database.js"></script>



    <!-- 사이드 메뉴 -->
    <ul>
        <li><a class="home_btn" href="./index.html"><img src="./image/earth-globe.png"
                                                         style="margin-right: 13px; height: 35px;">요<span style="color: #F17F42;">지</span>경</a></li>
        <hr style="margin-top: 15px; margin-left: 20px; margin-right: 30px;">

        <!-- 검색 -->
        <div class="ui search" style="margin-top: 20px; margin-left: 20px;">
            <div class="ui icon input">
                <input class="prompt" type="text" placeholder="나라 검색">
                <i class="search icon"></i>
            </div>
            <div class="results"></div>
        </div>

        <li><a class="vaccine_btn" href="#"><img src="./image/syringe.png" style="margin-right: 12px; height: 25px;">백신
            정보</a></li>
        <li><a class="flight_btn" href="#"><img src="./image/airplane.png" style="margin-right: 10px; height: 28px;">운항
            정보</a></li>
        <li><a class="recent_btn" href="#"><img src="./image/earth.png" style="margin-right: 15px; height: 22px;">나라별 최신
            정보</a></li>
    </ul>
    <div id="wrap">
        <div id="content_box" align="center">
            <div class="content1">
                <meta name="viewport" content="width=device-width, initial-scale=1">
                <iframe src="https://ourworldindata.org/explorers/coronavirus-data-explorer?zoomToSelection=true&time=2020-03-01..latest&pickerSort=desc&pickerMetric=total_vaccinations_per_hundred&Metric=Vaccine+doses&Interval=Cumulative&Relative+to+Population=true&Align+outbreaks=false&country=USA~GBR~ISR~DEU~ARE~ARG~FRA"
                                    width="100%" height="100%" scrolling="no" frameborder="1"></iframe>
            </div>
            <div class="content2" id="vaccine_table">
                <script>
                    // Your web app's Firebase configuration
                    var firebaseConfig = {
                        apiKey: "AIzaSyAZXBckbfCVzWW1u7ceGyuUPCA0o5MOWgk",
                        authDomain: "yojigyeong-14b71.firebaseapp.com",
                        databaseURL: "https://yojigyeong-14b71-default-rtdb.firebaseio.com",
                        projectId: "yojigyeong-14b71",
                        storageBucket: "yojigyeong-14b71.appspot.com",
                        messagingSenderId: "143152717689",
                        appId: "1:143152717689:web:0302d80da11df82e7599a8"
                    };
                    // Initialize Firebase
                    firebase.initializeApp(firebaseConfig);

                    const database = firebase.database();
                    const data_ = database.ref();
                    data_.on('value', snap => {
                        var count = Object.keys(snap.val()).length; //전체 나라 수

                        console.log("길이: ", count);
                        console.log("data_: ",snap.val());

                        for (var i=0;i<=count-1;i++){
                            var country_count = String(i);
                            var country = database.ref(country_count+'/data/');
                            country.on('value', snap =>{
                                var data_count = Object.keys(snap.val()).length;    //개별 나라에 들어있는 데이터 수
                                console.log("data_count: ", data_count);
                                console.log("country_data", snap.val());
                            })
                            var data_num = String(data_count-1);
                            country.child(data_num).on('value', snap =>{
                                console.log("data_latest", snap.val()); //가장 최신 데이터
                            })
                        }
                    })
                </script>
                <table class="ui celled table" id="jsonTable">
                    <thead>
                    <tr>
                        <th>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">국가이름</font>
                            </font>
                        </th>
                        <th>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">업데이트 날짜</font>
                            </font>
                        </th>
                        <th>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">일일 접종량</font>
                            </font>
                        </th>
                        <th>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">전체 접종량(%)</font>
                            </font>
                        </th>
                    </tr>
                    </thead>
                </table>

                <script>
                    // DataTables 라이브러리를 사용해 table 구성
                    $(document).ready(function () {

                        $.getJSON('./Json/recentNews.json', function (json) {
                            $('#jsonTable').append("<tbody>");
                            for (var counter = 0; counter < json.length; counter++) {
                                $('#jsonTable').append("<tr><td>" + json[counter].id + "</td><td>" + json[counter].countryName + "</td><td>" + json[counter].title + "</td><td>" + json[counter].wrtDt + "</td></tr>");
                            }
                            $('#jsonTable').append("</tbody>");
                            $('#jsonTable').DataTable();
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</body>
</html>